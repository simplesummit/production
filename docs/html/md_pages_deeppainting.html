<!-- HTML header for doxygen 1.8.13-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.15"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Simple Summit UI: Deep Painting</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="https://fonts.googleapis.com/css?family=Lato:300,400,700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/hack-font@3/build/web/hack.css">
<link href="my_customdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Simple Summit UI
   </div>
   <div id="projectbrief">An interface to be used for outreach for the Oak Ridge National Laboratory.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.15 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Deep Painting </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a href="http://www.youtube.com/watch?v=p5U4NgVGAwg" title="GauGAN: Changing Sketches into Photorealistic Masterpieces"><img src="../../src/GUI/assets/img/spade.jpeg" alt="SPADE" class="inline"/>
</a></p>
<h2>Background</h2>
<p>NeuralPaint is a GUI created to interface with a machine learning program called SPADE (short for Spatially-Adaptive Normalization) created by NVIDIA. SPADE is an implementation of a technique known as <em>semantic image synthesis</em> with spatially-adaptive normalization which takes in hand-drawn images as input and outputs photorealistic interpretations of those images. The paper covering this technique can be found <a href="https://nvlabs.github.io/SPADE/">here</a>.</p>
<h2>Install Project Dependencies</h2>
<div class="fragment"><div class="line">sudo apt-get install -y libblas-dev liblapack-dev libatlas-base-dev gfortran libjpeg-dev zlib1g-dev libfreetype6-dev</div></div><!-- fragment --><h2>Frontend Installation and Setup</h2>
<p>The Deep Painting application has both a frontend javascript GUI drawing application and a backend python Flask API to interface with the python SPADE code.</p>
<p>If you have already cloned the main repository containing all threee applications ensure that you have pulled the git submodules with '$ git submodule update &ndash;init &ndash;recursive' from within the main project directory. This will update the GUI, smoke, particles, and painting applications.</p>
<p>Next, change directories into the painting frontend directory <code>~/production/painting/frontend</code> and run the following commands.</p>
<div class="fragment"><div class="line"># Deep Painting Requires node version 8, ionic version 3, and cordova version 8.0.1</div><div class="line"></div><div class="line"># Uninstall to avoid conflicts if not using NVM</div><div class="line">npm uninstall -g cordova</div><div class="line">npm uninstall -g ionic</div><div class="line"></div><div class="line"># Install correct versions</div><div class="line">npm install -g ionic@3.9.2</div><div class="line">npm install -g cordova@8</div><div class="line"></div><div class="line"># Install project dependencies</div><div class="line">cd ~/production/painting/frontend</div><div class="line">npm install</div><div class="line"></div><div class="line"># Build production version to www directory</div><div class="line">ionic cordova build browser --prod</div></div><!-- fragment --><h2>Backend Installation and Setup</h2>
<p>Change directories into server folder with <code>cd ~/production/painting/frontend</code> and complete the following directions.</p>
<h3>Install Pytorch</h3>
<p>If you are running this project on NVIDIA Jetson follow the below steps. Else, install Pytorch based on instructions found on the <a href="https://pytorch.org/get-started/locally/">PyTorch Website</a></p>
<div class="fragment"><div class="line"># Choose an install location </div><div class="line">mkdir [install location]</div><div class="line">cd [install location]i</div><div class="line"></div><div class="line">git clone --recursive ttp://github.com/pytorch/pytorch</div><div class="line">cd pytorch</div><div class="line"></div><div class="line"># These are to avoid Pytorch CUDA errors when running CUDA 10. </div><div class="line">export USE_NCCL=0</div><div class="line">export USE_DISTRIBUTED=0</div><div class="line">export TORCH_CUDA_ARCH_LIST=&quot;5.3;6.2;7.2&quot;i</div><div class="line"></div><div class="line">sudo apt-get install python3-pip cmake</div><div class="line">sudo python3 -m pip install -U pip</div><div class="line">sudo python3 -m install -U setuptools</div><div class="line">sudo python3 -m install -r requirements.txt</div><div class="line">sudo python3 -m pip install scikit-build --user</div><div class="line">sudo python3 -m pip install ninja --useri</div><div class="line"></div><div class="line"># This  will take a long time</div><div class="line">python3 setup.py bdist_wheel</div><div class="line">sudo python3 setup.py install --user</div></div><!-- fragment --><h3>Install Pillow</h3>
<p>If you are running on an NVIDIA Jetson or any other ARM device there may not be a pip wheel available to you for Pillow. To fix this we must build Pillow from source.</p>
<div class="fragment"><div class="line">cd [install location]</div><div class="line">git clone https://github.com/python-pillow/Pillow.git</div><div class="line">cd Pillow</div><div class="line">sudo python3 setup.py install</div></div><!-- fragment --><h3>Install remaining dependencies with pip</h3>
<div class="fragment"><div class="line">cd ~/production/painting/server</div><div class="line">sudo python3 -m pip install -r requirements.txt</div></div><!-- fragment --><h2>Run Frontend and Backend</h2>
<h3>Running frontend</h3>
<div class="fragment"><div class="line">cd ~/production/painting/frontend/www</div><div class="line">python3 -m http.server 8000</div></div><!-- fragment --> <h3>Running Backend</h3>
<div class="fragment"><div class="line">cd ~/production/painting/server</div><div class="line">sudo python3 server.py</div></div><!-- fragment --><h2>Running Frontend and Backend as Background Services</h2>
<p>Both the backend and frontend of the Deep Painting application can be run persistently with minimal resource usage as lost as the server does not have images in its que. This can best be accomplished through the use of supervisord due to its simplicity and dependability when it comes to python programs.</p>
<h3>Three System Services Must Be Created</h3>
<ul>
<li>Supervisord service<ul>
<li>Webpage GUI (frontend) service</li>
<li>SPADE (backend) service</li>
</ul>
</li>
</ul>
<h3>Supervisord Installation</h3>
<div class="fragment"><div class="line">sudo apt-get install supervisor</div><div class="line">sudo supervisord</div></div><!-- fragment --> <h3>Ensure that Supervisord is running</h3>
<div class="fragment"><div class="line">$ sudo service supervisor status</div></div><!-- fragment --> <h3>Create Frontend and Backend Services</h3>
<div class="fragment"><div class="line">sudo vi /etc/supervisor/conf.d/frontend.conf</div></div><!-- fragment --><p> Paste the following </p><div class="fragment"><div class="line">[program:frontend]</div><div class="line">command/usr/bin/sudo /usr/bin/python3 -m http.server 8000</div><div class="line">directory=/home/[Username]/production/painting/frontend</div><div class="line">stdout_logfile=/home/[Username]/production/logs/frontend.txt</div><div class="line">redirect_stderr=true</div><div class="line">autostart=true</div><div class="line">autorestart=true</div></div><!-- fragment --> <div class="fragment"><div class="line">sudo vi /etc/supervisor/conf.d/spade.conf</div></div><!-- fragment --><p> Paste the following </p><div class="fragment"><div class="line">[program:spade]</div><div class="line">user=node-5</div><div class="line">directory=/home/node-5/production/painting/server</div><div class="line">command=sudo python3 server.py</div><div class="line">autostart=true</div><div class="line">autorestart=true</div></div><!-- fragment --><p> Now that you have created both services you need to activiate them using supervisor </p><div class="fragment"><div class="line">sudo supervisorctl</div><div class="line">supervisor &gt; reread</div><div class="line">supervisor &gt; add test_process</div><div class="line">supervisor &gt; status</div></div><!-- fragment --><h3>Supervisord Web Interface</h3>
<p>If you want you can monitor your services in using Supervisord's web interface.</p>
<p>To enable this add the following config to the config file found in <code>/etc/supervisor/supervisord.conf</code></p>
<div class="fragment"><div class="line">[inet_http_server]</div><div class="line">port=*:9001</div><div class="line">username=testuser</div><div class="line">password=testpass</div></div><!-- fragment --> </div></div><!-- PageDoc -->
</div><!-- contents -->
<!-- HTML footer for doxygen 1.8.13-->
<!-- start footer part -->
<!-- <hr class="footer"/> -->
<address class="footer">
    <small>
Generated on Fri Aug 2 2019 09:39:33 for Simple Summit UI by &#160;<a href="http://www.doxygen.org/index.html">
        <img class="footer" src="doxygen.png" alt="doxygen"/>
        </a> 1.8.15
    </small>
</address>
</body>
</html>
